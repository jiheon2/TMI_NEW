<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- JAVA와 연결할 Mapper 파일 설정 -->
<mapper namespace="kopo.poly.persistance.mapper.IGoodsMapper">

    <!-- 상품 목록 조회 쿼리 -->
    <select id="getGoodsList" parameterType="GoodsDTO" resultType="GoodsDTO">
        SELECT GOODS_NAME, PRICE, GOODS_TYPE, SHOP_NUMBER, GOODS_NUMBER
        FROM GOODS
        WHERE SHOP_NUMBER = #{shopNumber}
        ORDER BY GOODS_NUMBER DESC
    </select>

    <!-- 상품 정보 조회 쿼리 -->
    <select id="getGoodsInfo" parameterType="GoodsDTO" resultType="GoodsDTO">
        SELECT GOODS_NAME, PRICE, GOODS_TYPE, GOODS_DESCRIPTION, GOODS_IMGAE, GOODS_NUMBER, SHOP_NUMBER
        FROM GOODS
        WHERE SHOP_NUMBER = #{shopNumber}
          AND GOODS_NUMBER = #{goodsNumber}
    </select>

    <!-- 상품 정보 수정 쿼리 -->
    <update id="updateGoodsInfo" parameterType="GoodsDTO">
        UPDATE GOODS
        SET GOODS_NAME  = #{goodsName},
            PRICE = #{price},
            GOODS_DESCRIPTION   = #{goodsDescription},
            GOODS_TYPE  = #{goodsType},
            GOODS_IMGAE = #{goodsImage}
        WHERE SHOP_NUMBER = #{shopNumber}
          AND GOODS_NUMBER = #{goodsNumber}
    </update>

    <!-- 상품 등록 쿼리 -->
    <insert id="insertGoodsInfo" parameterType="GoodsDTO">
        INSERT INTO GOODS (SHOP_NUMBER, GOODS_NAME, GOODS_TYPE, PRICE, GOODS_DESCRIPTION, GOODS_NUMBER, GOODS_IMGAE)
        VALUES (#{shopNumber}, #{goodsName}, #{goodsType}, #{price}, #{goodsDescription}, (SELECT IFNULL(MAX(A.GOODS_NUMBER), 0) + 1 FROM GOODS A), #{goodsImage})
    </insert>

    <!-- 등록 상품 삭제 쿼리 -->
    <delete id="goodsInfoDelete" parameterType="GoodsDTO">
        DELETE
        FROM GOODS
        WHERE GOODS_NUMBER = #{goodsNumber}
          AND SHOP_NUMBER = #{shopNumber}
    </delete>
</mapper>