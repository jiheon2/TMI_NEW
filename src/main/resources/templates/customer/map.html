<!doctype html>
<html lang="zxx">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>aranoz</title>
    <link rel="icon" href="/assets/images/favicon.png">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="/assets/css/bootstrap.min.css">
    <!-- animate CSS -->
    <link rel="stylesheet" href="/assets/css/animate.css">
    <!-- owl carousel CSS -->
    <link rel="stylesheet" href="/assets/css/owl.carousel.min.css">
    <!-- font awesome CSS -->
    <link rel="stylesheet" href="/assets/css/all.css">
    <!-- flaticon CSS -->
    <link rel="stylesheet" href="/assets/css/flaticon.css">
    <link rel="stylesheet" href="/assets/css/themify-icons.css">
    <!-- font awesome CSS -->
    <link rel="stylesheet" href="/assets/css/magnific-popup.css">
    <!-- swiper CSS -->
    <link rel="stylesheet" href="/assets/css/slick.css">
    <!-- style CSS -->
    <link rel="stylesheet" href="/assets/css/style.css">
    <script src="https://kit.fontawesome.com/cb71939295.js" crossorigin="anonymous"></script>
    <script type="text/javascript"
            src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=ekfqtwltvc"></script>

</head>

<body>
<!--::header part start::-->
<header class="main_menu home_menu">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-12">
                <nav class="navbar navbar-expand-lg navbar-light">
                    <a class="navbar-brand" href="index.html"> <img src="/assets/images/logo.png" alt="logo"> </a>
                    <select name="시">
                        <option>시</option>
                        <option value="학생">서울특별시</option>
                        <option value="회사원">부산광역시</option>
                        <option value="기타">대구광역시</option>
                    </select>
                    <select name="구">
                        <option value="">구</option>
                        <option value="학생">중랑구</option>
                        <option value="회사원">동대문구</option>
                        <option value="기타">강서구</option>
                    </select>
                    <div class="collapse navbar-collapse main-menu-item" id="navbarSupportedContent"
                         style="height: 100px">
                    </div>


                    <div class="hearer_icon d-flex">
                        <div>
                            <a><i class="fa-solid fa-map-location-dot" style="font-size:25px"></i>
                            </a>
                        </div>
                        <div>
                            <a><i class="fa-solid fa-comments" style="font-size:25px"></i>
                            </a>
                        </div>
                        <a href=""><i class="fa-solid fa-heart" style="font-size:25px"></i></a>

                        <div class="dropdown cart">
                            <a class="dropdown-toggle" href="#" id="navbarDropdown3" role="button"
                               data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <i class="fas fa-cart-plus" style="font-size:25px"></i>
                            </a>
                        </div>
                        <a><i class="fa-solid fa-customer" style="font-size:25px"></i>
                        </a>
                    </div>
                </nav>
            </div>
        </div>
    </div>

</header>
<!-- Header part end-->
<!--  aside  -->
<!-- breadcrumb start-->
<section class="breadcrumb breadcrumb_bg" style="background-image: url(/assets/images/about_img.png)">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="breadcrumb_iner">
                    <div class="breadcrumb_iner_item">
                        <h2>지도</h2>
                        <p>시장 위치를 알려드립니다</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- breadcrumb start-->
<!--  aside  -->

<div style="height: 100px; "></div>


<div id="map" style="text-align: center; width:60%; height:800px; margin: auto;"></div>
<div style="height: 50px; "></div>


<script>
    var map;
    var markers = [];

    // 네이버 지도 API 로드 후 실행될 콜백 함수
    function initMap() {
        // 브라우저의 Geolocation API를 사용하여 현재 위치를 가져옵니다.
        navigator.geolocation.getCurrentPosition(function (position) {
            var currentLatLng = new naver.maps.LatLng(position.coords.latitude, position.coords.longitude);

            // 지도를 현재 위치로 설정하고 줌 컨트롤을 추가합니다.
            map = new naver.maps.Map('map', {
                center: currentLatLng,
                zoom: 15,
                zoomControl: true, // 줌 컨트롤 추가
                zoomControlOptions: {
                    position: naver.maps.Position.TOP_RIGHT // 줌 컨트롤의 위치 지정
                }
            });

            // 서버에서 도로명 주소를 비동기적으로 가져오기
            fetchAddressFromServer(currentLatLng);
        }, function (error) {
            console.warn('ERROR(' + error.code + '): ' + error.message);
        });
    }

    // 서버에서 도로명 주소를 가져오고, 그 주소를 이용하여 좌표를 얻어내는 함수
    function fetchAddressFromServer(currentLatLng) {
        // Ajax 요청
        $.ajax({
            url: '/market/marker', // 서버의 도로명 주소를 가져올 API 엔드포인트 URL을 설정
            method: 'GET',
            data: {
                shopCode: ""
            },
            success: function (data) {
                // 서버로부터 받은 도로명 주소를 기반으로 좌표를 얻어내어 마커를 생성
                if (data.address) {
                    geocodeAddressAndCreateMarker(data.address);
                } else {
                    console.error('No address data received from the server');
                }
            },
            error: function (xhr, status, error) {
                console.error('Ajax request failed, status: ' + status + ', error: ' + error);
            }
        });
    }

    // 도로명 주소를 이용하여 좌표를 얻어내어 마커를 생성하는 함수
    function geocodeAddressAndCreateMarker(address) {
        // Geocoding 서비스를 이용하여 도로명 주소를 좌표로 변환
        naver.maps.Service.geocode({
            query: address
        }, function (status, response) {
            if (status === naver.maps.Service.Status.OK) {
                var result = response.result;

                if (result.items.length > 0) {
                    var firstItem = result.items[0];
                    var position = new naver.maps.LatLng(firstItem.point.y, firstItem.point.x);

                    // 변환된 좌표를 기반으로 마커를 생성
                    createMarkers([{ lat: position._lat, lng: position._lng, title: 'Current Position' }]);
                } else {
                    console.error('No result found from Geocoding service');
                }
            } else {
                console.error('Geocoding service failed, status: ' + status);
            }
        });
    }

    // 나머지 코드는 이전과 동일하게 유지됩니다.

    // 네이버 지도 API 로드가 완료된 후 initMap 함수를 실행합니다.
    naver.maps.onJSContentLoaded = initMap;
</script>
</body>
</html>
</script>


<script src="/js/jquery-3.6.0.min.js"></script>
<!-- jquery plugins here-->
<script src="/assets/js/jquery-1.12.1.min.js"></script>
<!-- popper js -->
<script src="/assets/js/popper.min.js"></script>
<!-- bootstrap js -->
<script src="/assets/js/bootstrap.min.js"></script>
<!-- easing js -->
<script src="/assets/js/jquery.magnific-popup.js"></script>
<!-- swiper js -->
<script src="/assets/js/swiper.min.js"></script>
<!-- swiper js -->
<script src="/assets/js/masonry.pkgd.js"></script>
<!-- particles js -->
<script src="/assets/js/owl.carousel.min.js"></script>
<script src="/assets/js/jquery.nice-select.min.js"></script>
<!-- slick js -->
<script src="/assets/js/slick.min.js"></script>
<script src="/assets/js/jquery.counterup.min.js"></script>
<script src="/assets/js/waypoints.min.js"></script>
<script src="/assets/js/contact.js"></script>
<script src="/assets/js/jquery.ajaxchimp.min.js"></script>
<script src="/assets/js/jquery.form.js"></script>
<script src="/assets/js/jquery.validate.min.js"></script>
<script src="/assets/js/mail-script.js"></script>
<!-- custom js -->
<script src="/assets/js/custom.js"></script>
</body>
</html>
